
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <title>CDI Â· Fabric8 Documentation</title>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.0.3">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-anchors/plugin.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="annotations.html" />
    
    
    <link rel="prev" href="javaLibraries.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="overview.html">
            
                <a href="overview.html">
            
                    
                    Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="getStarted/">
            
                <a href="getStarted/">
            
                    
                    Getting Started
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="getStarted/vagrant.html">
            
                <a href="getStarted/vagrant.html">
            
                    
                    Use Vagrant
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="getStarted/kubernetes.html">
            
                <a href="getStarted/kubernetes.html">
            
                    
                    Use Kubernetes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="getStarted/gke.html">
            
                <a href="getStarted/gke.html">
            
                    
                    Use Kubernetes on GKE
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="getStarted/openshift.html">
            
                <a href="getStarted/openshift.html">
            
                    
                    Use OpenShift
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.4.1" data-path="getStarted/installOpenShift.html">
            
                <a href="getStarted/installOpenShift.html">
            
                    
                    Install OpenShift
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="getStarted/cdk.html">
            
                <a href="getStarted/cdk.html">
            
                    
                    Use CDK
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="getStarted/apps.html">
            
                <a href="getStarted/apps.html">
            
                    
                    Installing apps
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7" data-path="getStarted/local.html">
            
                <a href="getStarted/local.html">
            
                    
                    Setup Local OpenShift Client
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.8" data-path="getStarted/develop.html">
            
                <a href="getStarted/develop.html">
            
                    
                    Develop locally
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.9" data-path="getStarted/browserCertificates.html">
            
                <a href="getStarted/browserCertificates.html">
            
                    
                    Accept self-signed certs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.10" data-path="getStarted/troubleshooting.html">
            
                <a href="getStarted/troubleshooting.html">
            
                    
                    Troubleshooting
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="develop/">
            
                <a href="develop/">
            
                    
                    Developing Microservices
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="develop/elasticity.html">
            
                <a href="develop/elasticity.html">
            
                    
                    Elasticity and Resilience
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="develop/designForFailure.html">
            
                <a href="develop/designForFailure.html">
            
                    
                    Design for Failure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="develop/serviceDiscovery.html">
            
                <a href="develop/serviceDiscovery.html">
            
                    
                    Service Discovery
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="develop/loadBalancing.html">
            
                <a href="develop/loadBalancing.html">
            
                    
                    Load balancing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="develop/pipelines.html">
            
                <a href="develop/pipelines.html">
            
                    
                    Pipelines
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="develop/logging.html">
            
                <a href="develop/logging.html">
            
                    
                    Logging
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="develop/monitoring.html">
            
                <a href="develop/monitoring.html">
            
                    
                    Monitoring
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8" data-path="develop/tracing.html">
            
                <a href="develop/tracing.html">
            
                    
                    Tracing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.9" data-path="develop/circuitBreakers.html">
            
                <a href="develop/circuitBreakers.html">
            
                    
                    Circuit Breakers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.10" data-path="develop/configuration.html">
            
                <a href="develop/configuration.html">
            
                    
                    Configuration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.11" data-path="testing.html">
            
                <a href="testing.html">
            
                    
                    Testing
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="fabric8DevOps.html">
            
                <a href="fabric8DevOps.html">
            
                    
                    Microservices Platform
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="console.html">
            
                <a href="console.html">
            
                    
                    Developer Console
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="cdelivery.html">
            
                <a href="cdelivery.html">
            
                    
                    CI and CD
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.2.1" data-path="jenkinsWorkflowLibrary.html">
            
                <a href="jenkinsWorkflowLibrary.html">
            
                    
                    Jenkins Workflow Library
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.2" data-path="fabric8YmlFile.html">
            
                <a href="fabric8YmlFile.html">
            
                    
                    fabric8.yml file
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="management.html">
            
                <a href="management.html">
            
                    
                    Management
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.3.1" data-path="logging.html">
            
                <a href="logging.html">
            
                    
                    Logging
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3.2" data-path="metrics.html">
            
                <a href="metrics.html">
            
                    
                    Metrics
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="chat.html">
            
                <a href="chat.html">
            
                    
                    Chat
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="chaosMonkey.html">
            
                <a href="chaosMonkey.html">
            
                    
                    Chaos Monkey
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="ipaas.html">
            
                <a href="ipaas.html">
            
                    
                    Integration
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="fabric8MQ.html">
            
                <a href="fabric8MQ.html">
            
                    
                    Messaging
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="apiManagement.html">
            
                <a href="apiManagement.html">
            
                    
                    API Management
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.2.1" data-path="apimanComponents.html">
            
                <a href="apimanComponents.html">
            
                    
                    Apiman Components
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.2" data-path="apimanGettingStarted.html">
            
                <a href="apimanGettingStarted.html">
            
                    
                    Getting Started
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.3" data-path="apimanDataModel.html">
            
                <a href="apimanDataModel.html">
            
                    
                    Data Model
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.4" data-path="apimanImportService.html">
            
                <a href="apimanImportService.html">
            
                    
                    Publish Service
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.5" data-path="apimanConsumeService.html">
            
                <a href="apimanConsumeService.html">
            
                    
                    Consume a Service
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="quickstarts/">
            
                <a href="quickstarts/">
            
                    
                    Quickstarts
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="quickstarts/archetypes.html">
            
                <a href="quickstarts/archetypes.html">
            
                    
                    Archetypes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="quickstarts/running.html">
            
                <a href="quickstarts/running.html">
            
                    
                    Running
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="quickstarts/walkthrough.html">
            
                <a href="quickstarts/walkthrough.html">
            
                    
                    Walk-through
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="tools.html">
            
                <a href="tools.html">
            
                    
                    Tools
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="forge.html">
            
                <a href="forge.html">
            
                    
                    Forge
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1.1" data-path="camelMavenPlugin.html">
            
                <a href="camelMavenPlugin.html">
            
                    
                    Camel Maven Plugin
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="mavenPlugin.html">
            
                <a href="mavenPlugin.html">
            
                    
                    Maven Plugin
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.2.1" data-path="mavenDockerBuild.html">
            
                <a href="mavenDockerBuild.html">
            
                    
                    docker:build
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2.2" data-path="mavenDockerPush.html">
            
                <a href="mavenDockerPush.html">
            
                    
                    docker:push
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2.3" data-path="mavenFabric8Apply.html">
            
                <a href="mavenFabric8Apply.html">
            
                    
                    fabric8:apply
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2.4" data-path="mavenFabric8CreateEnv.html">
            
                <a href="mavenFabric8CreateEnv.html">
            
                    
                    fabric8:create-env
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2.5" data-path="mavenFabric8CreateRoutes.html">
            
                <a href="mavenFabric8CreateRoutes.html">
            
                    
                    fabric8:create-routes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2.6" data-path="mavenFabric8DeletePods.html">
            
                <a href="mavenFabric8DeletePods.html">
            
                    
                    fabric8:delete-pods
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2.7" data-path="mavenFabric8DevOps.html">
            
                <a href="mavenFabric8DevOps.html">
            
                    
                    fabric8:devops
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2.8" data-path="mavenFabric8Helm.html">
            
                <a href="mavenFabric8Helm.html">
            
                    
                    fabric8:helm
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2.9" data-path="mavenFabric8HelmPush.html">
            
                <a href="mavenFabric8HelmPush.html">
            
                    
                    fabric8:helm-push
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2.10" data-path="mavenFabric8Json.html">
            
                <a href="mavenFabric8Json.html">
            
                    
                    fabric8:json
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.2.10.1" data-path="annotationProcessors.html">
            
                <a href="annotationProcessors.html">
            
                    
                    annotation processors
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.2.11" data-path="mavenFabric8Recreate.html">
            
                <a href="mavenFabric8Recreate.html">
            
                    
                    fabric8:recreate
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2.12" data-path="mavenFabric8Rolling.html">
            
                <a href="mavenFabric8Rolling.html">
            
                    
                    fabric8:rolling
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="helm.html">
            
                <a href="helm.html">
            
                    
                    Helm
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="javaLibraries.html">
            
                <a href="javaLibraries.html">
            
                    
                    Java Libraries
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.8.5" data-path="cdi.html">
            
                <a href="cdi.html">
            
                    
                    CDI
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="annotations.html">
            
                <a href="annotations.html">
            
                    
                    Annotations
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="secretAnnotations.html">
            
                <a href="secretAnnotations.html">
            
                    
                    Secret Annotations
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="architecture.html">
            
                <a href="architecture.html">
            
                    
                    Architecture
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="pods.html">
            
                <a href="pods.html">
            
                    
                    Pods
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="replicationControllers.html">
            
                <a href="replicationControllers.html">
            
                    
                    Replication Controllers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="labels.html">
            
                <a href="labels.html">
            
                    
                    Labels
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4" data-path="services.html">
            
                <a href="services.html">
            
                    
                    Services
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.5" data-path="apps.html">
            
                <a href="apps.html">
            
                    
                    Apps
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.6" data-path="environments.html">
            
                <a href="environments.html">
            
                    
                    Environments
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.7" data-path="builds.html">
            
                <a href="builds.html">
            
                    
                    Builds
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="projects.html">
            
                <a href="projects.html">
            
                    
                    Source Code
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="v2-changes.html">
            
                <a href="v2-changes.html">
            
                    
                    Changes from V1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="FAQ.html">
            
                <a href="FAQ.html">
            
                    
                    FAQ
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.13.1" data-path="faqGeneral.html">
            
                <a href="faqGeneral.html">
            
                    
                    General Questions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.2" data-path="faqFuse.html">
            
                <a href="faqFuse.html">
            
                    
                    JBoss Fuse Questions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.3" data-path="faqKubernetes.html">
            
                <a href="faqKubernetes.html">
            
                    
                    Kubernetes Questions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.4" >
            
                <a target="_blank" href="https://help.openshift.com/hc/en-us/categories/200177370-Frequently-Asked-Questions">
            
                    
                    OpenShift Questions
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >CDI</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h2 id="cdi"><a name="undefined" class="plugin-anchor" href="#undefined"><span class="fa fa-link"></span></a>CDI</h2>
<p>Fabric8 provides a CDI extension which is meant to make developing CDI apps for kubernetes easier.</p>
<p>Using CDI it is possible to:</p>
<ul>
<li>Inject a fabric8 managed kubernetes client.</li>
<li>Inject URL to kubernetes service using the @ServiceName and @PortName annotations.</li>
<li>Inject a client for a kubernetes service using the @ServiceName and @Factory.</li>
<li>Inject configuration provided as Environamnt Variables.</li>
<li>Create scopes of configuration using the @Configuration.</li>
</ul>
<p>The CDI extension works for application that live both inside and outside of kubernetes. So it can be used safely in kubernetes and hybrid deployments for easier consumption of kubernetes managed services.</p>
<h3 id="the-servicename-annotation"><a name="undefined" class="plugin-anchor" href="#undefined"><span class="fa fa-link"></span></a>The @ServiceName annotation</h3>
<p>In kubernetes, each service has a host and a port and they are passed to container as environment variable. Containers that live inside Kubernetes
can lookup for services using their environment variables. Application that live outside of kubernetes need to use the kubernetes API in order to perform lookups.</p>
<p>The fabric8 extension provides a unified approach in looking up for service coordinates. It provides the @ServiceName qualifier which can be used to inject the coordinates as a String or as a URL by just referring to the id of the service.</p>
<pre><code>@Inject
@ServiceName(&quot;my-service&quot;)
private String service.
</code></pre><h3 id="the-protocol-annotation"><a name="undefined" class="plugin-anchor" href="#undefined"><span class="fa fa-link"></span></a>The @Protocol annotation</h3>
<p>Kubernetes uses the notion of Protocol to refer to the transport protocol TCP or UDP. In Java URL its more useful to use the application protocol.
One could find and replace the transport protocol with the actual application protocol but that its really smelly.</p>
<p>The CDI extension supports the @Protocol annotation which allows the user to specify the application protocol to use.</p>
<pre><code>    @Inject
    @ServiceName(&quot;my-ftp-service&quot;)
    @Protocol(&quot;ftp&quot;)
    private String service.
</code></pre><h3 id="the-portname-annotation"><a name="undefined" class="plugin-anchor" href="#undefined"><span class="fa fa-link"></span></a>The @PortName annotation</h3>
<p>In Kubernetes a service may define multiple ports. Fabric8 provides a qualifier which can be used to select a specific port by name.</p>
<pre><code>    @Inject
    @ServiceName(&quot;my-service&quot;)
    @PortName(&quot;my-port&quot;)
    private String service.
</code></pre><p>If for a multiport service no @PortName qualifier is specified, the first port on the list will be used.</p>
<h3 id="the-path-annotation"><a name="undefined" class="plugin-anchor" href="#undefined"><span class="fa fa-link"></span></a>The @Path annotation</h3>
<p>In the same spirit with the @Protocol annotation this extension also supports the @Path annotation, for the cases that we need the injected value to be decorated with a custom path.</p>
<pre><code>            @Inject
            @ServiceName(&quot;mysqldb&quot;)
            @Protocol(&quot;jdbc:mysql&quot;)
            @Path(&quot;db1&quot;)
            private String urlForDb1.

            @Inject
            @ServiceName(&quot;mysqldb&quot;)
            @Protocol(&quot;jdbc:mysql&quot;)
            @Path(&quot;db2&quot;)
            private String urlForDb2.                        
</code></pre><h3 id="the-endpoint-annotation"><a name="undefined" class="plugin-anchor" href="#undefined"><span class="fa fa-link"></span></a>The @Endpoint annotation</h3>
<p>There are cases, where we don&apos;t want to access the Service IP but we want to access and endpoint to the service.
A very good example are headless service, which doesn&apos;t have a Service IP. You can instruct the framework to use endpoints instead of the Service with the @Endpoint annotation.</p>
<pre><code>    @Inject
    @ServiceName(&quot;headless-service&quot;)
    @Endpoint
    private String service.
</code></pre><p>If more than one endpoints are available for the service, the first found will be the one injected. But you can access them all by using a List or a Set.</p>
<pre><code>    @Inject
    @ServiceName(&quot;headless-service&quot;)
    @Endpoint
    private List&lt;String&gt; services.
</code></pre><p>In case of Set or List injection the @Endpoint annotation can also be assumed.        </p>
<h3 id="running-inside-and-outside-of-kubernetes"><a name="undefined" class="plugin-anchor" href="#undefined"><span class="fa fa-link"></span></a>Running inside and outside of Kubernetes</h3>
<p>Under the covers the code will default to using the <strong>MY_SERVICE_SERVICE_HOST</strong> and <strong>MY_SERVICE_SERVICE_PORT</strong> environment variables exposed by <a href="services.html">kubernetes services</a> to discover the IP and port to use to connect to the service. Kubernetes sets those environment variables automatically when your pod is run inside Kubernetes.</p>
<p>If your Java code is running outside of Kubernetes then @ServiceName will use the environment variable <strong>KUBERNETES_MASTER</strong> to connect to the kubernetes REST API and then use that to discover where the services are. This lets you run the same Java code in a test, in your IDE and inside kubernetes.</p>
<h3 id="integration-with-openshift-routes"><a name="undefined" class="plugin-anchor" href="#undefined"><span class="fa fa-link"></span></a>Integration with OpenShift routes</h3>
<p>In any case if a Route is available that match the Service we need to inject, the route host will be used instead.
Currently route will be used only if @Protocol or @PortName haven&apos;t been explicitly specified and only if OpenShift is available.</p>
<h3 id="creating-custom-objects"><a name="undefined" class="plugin-anchor" href="#undefined"><span class="fa fa-link"></span></a>Creating custom objects</h3>
<p>In most of the cases the user will create a client so that it can consume the service. This can be easily done using the injection point and a manual kubernetes service lookup.</p>
<pre><code>@Produces
@ServiceName
public MyClient create(InjectionPoint ip) {
    Service service = ip.getAnnotated().getAnnotation(Service.class);
    String url = Services.toServiceUrl(service.getId(), service.getProtocol());
    return new MyClient(url);
}
</code></pre><h3 id="using-factories"><a name="undefined" class="plugin-anchor" href="#undefined"><span class="fa fa-link"></span></a>Using Factories</h3>
<p>The example above is something that works but it does require boilerplate.
To simplify the code Fabric8 provides the @Factory annotation.</p>
<pre><code>   @Factory
   @ServiceName
   public MyClient create(@ServiceName String url) {
       return new MyClient(url);
   }
</code></pre><h3 id="integration-with-apache-deltaspike"><a name="undefined" class="plugin-anchor" href="#undefined"><span class="fa fa-link"></span></a>Integration with Apache Deltaspike</h3>
<p>In kubernetes its quite common to pass around configuration via Environment Variables. Outside of kubernetes java developers often use System properties, property files and what not.
DeltaSpike provides an awesome extension which works great along with the fabric8 extension that allows the user to inject configuration form various sources:</p>
<ul>
<li>System Properties</li>
<li>Environment Variables</li>
<li>JNDI values</li>
<li>Property Files</li>
</ul>
<h4 id="the-configproperty-annotation"><a name="undefined" class="plugin-anchor" href="#undefined"><span class="fa fa-link"></span></a>The @ConfigProperty annotation</h4>
<p>Using the @ConfigProperty annotation the user can inject configuration from the sources mentioned above. The lookup is performed in the exact same order provided above.
It&apos;s use is pretty straight-forward:</p>
<h4 id="putting-it-all-together"><a name="undefined" class="plugin-anchor" href="#undefined"><span class="fa fa-link"></span></a>Putting it all together</h4>
<p>In most case, when we need to consume a service we need both the coordinates of the service and static configuration data, like thread pool configuration, maximum number of connections etc.
So it makes sense when we create the &quot;factory&quot; for our client, to also inject configuration. For example:</p>
<pre><code>@Inject
@ConfigProperty(name=&quot;CONNECTION_TIMEOUT&quot;, defaultValue=&quot;10000L&quot;)
private Long timeout; 

@Produces
@ServiceName
public MyClient create(@ServiceName url) {
    return new MyClient(url, timeout);
}
</code></pre><p>But what happens if we need  to create multiple instances of MyClient each configured differently?</p>
<h4 id="the-configuration-annotation"><a name="undefined" class="plugin-anchor" href="#undefined"><span class="fa fa-link"></span></a>The @Configuration annotation</h4>
<p>The configuration annotation allows you to group a set of configuration properties together as part of a bean and instantiate it with different configuration values, depending the context.</p>
<p>For example let&apos;s assume that <strong>MyClient</strong> which has been used in the previous examples, requires a timeout and a pool size for its configuration. And we need to configure multiple instances of MyClient.
The configuration of MyClient can be encapsulated like this:</p>
<pre><code>public class MyConfig {
    private final Integer poolSize;
    private final Long timeout;
}
</code></pre><p>The obvious way would be to create 2 classes for MyConfig each using a different set of annotations. The worst part is that then we would also need to create 2 instances of @Produces each consuming a different set of configuration. Which becomes really painful even for a simple example like this.</p>
<p>The alternative approach is to use the @Configuration annotation and a simple convention: &quot;For all configuration sets, keys are named the same and use a descriminator prefix&quot;. This would allow use to use a single MyConfig class and only specifiy the <strong>descriminator</strong> where we need to.</p>
<pre><code> public class MyConfig {
     @Inject
     @ConfigProperty(name=&quot;POOL_SIZE&quot;, defaultValue=&quot;10&quot;)         
     private final Integer poolSize;

     @Inject
     @ConfigProperty(name=&quot;CONNECTION_TIMEOUT&quot;, defaultValue=&quot;10000L&quot;)
     private final Long timeout;
 }
</code></pre><p>The discriminator only needs to be specified at the point where configuration is consumed.</p>
<pre><code>    @Inject
    @Configuration(&quot;SERVICE_1&quot;)
    private MyConfig cfg1;

    @Inject
    @Configuration(&quot;SERVICE_2&quot;)
    private MyConfig cfg2;
</code></pre><h4 id="combining-factory-servicename-and-configuration-annotations"><a name="undefined" class="plugin-anchor" href="#undefined"><span class="fa fa-link"></span></a>Combining @Factory, @ServiceName and @Configuration annotations</h4>
<p>To further reduce the amount of boilerplate one could use all of the annotations to create generic factories that accepts as parameters service urls and configuration.</p>
<pre><code>public class MyFactory {
    @Factory
    @ServiceName
    MyClient create(@ServiceName String url, @Configuration MyConfig cfg) {
        return MyClient(url, cfg);  
    }
}
</code></pre><p>The you can directly inject the client:</p>
<pre><code>    @Inject
    @ServiceName(&quot;SERVICE_1&quot;)
    private MyClient cl1;

    @Inject
    @ServiceName(&quot;SERVICE_2&quot;)
    private MyClient cl2;        
</code></pre><p>In this approach the benefit is double as both the configuration and the service url are not needed to be specified in the factory but just to the place where the client is consumed. That makes the factory reusable and reduces the amount of code needed.</p>
<p>Factories can also make use of the @Protocol and @PortName annotations to set default values for protocol and port name.</p>
<pre><code>public class MyDataSourceFactory {
    @Factory
    @ServiceName
    DataSource create(@ServiceName @Protocol(&quot;jdbc:mysql&quot;) @PortName(&quot;mysqld-port&quot;) String url, @Configuration MyConfig cfg) {
        DataSource ds = null;
        ...
        return ds;  
    }
}
</code></pre><p>If @Protocol or @PortName are present on the actual injection point to, they will take precedence over what&apos;s found here.    </p>
<h4 id="injection-of-optional-services"><a name="undefined" class="plugin-anchor" href="#undefined"><span class="fa fa-link"></span></a>Injection of Optional Services</h4>
<p>A common approach for treating with Optional services in CDI is to use Instance injection. For example:</p>
<pre><code>@Inject
Instance&lt;MyClient&gt; instance;

...

MyClient client = instance.get();
</code></pre><p>The Fabric8 CDI extension supports instance injection for all kinds of injection including @Factory.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="javaLibraries.html" class="navigation navigation-prev " aria-label="Previous page: Java Libraries">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="annotations.html" class="navigation navigation-next " aria-label="Next page: Annotations">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"CDI","level":"1.8.5","depth":2,"next":{"title":"Annotations","level":"1.9","depth":1,"path":"annotations.md","ref":"annotations.md","articles":[{"title":"Secret Annotations","level":"1.9.1","depth":2,"path":"secretAnnotations.md","ref":"secretAnnotations.md","articles":[]}]},"previous":{"title":"Java Libraries","level":"1.8.4","depth":2,"path":"javaLibraries.md","ref":"javaLibraries.md","articles":[]},"dir":"ltr"},"config":{"plugins":["anchors"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"anchors":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"github":"fabric8io/fabric8","theme":"default","githubHost":"https://github.com/","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":36,"bottom":36},"toc":true},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"Fabric8 Documentation","links":{"home":"http://fabric8.io/","about":"http://fabric8.io/docs/index.html","issues":"https://github.com/fabric8io/fabric8/issues?milestone=none&state=closed","contribute":"http://fabric8.io/contributing/index.html","sharing":{"google":null,"facebook":null,"twitter":"https://twitter.com/fabric8io"}},"gitbook":">=2.0.0","description":"Fabric8 User Guide and Reference Documentation","extension":"pdf"},"file":{"path":"cdi.md","mtime":"2016-06-01T14:38:35.000Z","type":"markdown"},"gitbook":{"version":"3.0.3","time":"2016-06-01T14:43:28.370Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/buttons.js"></script>
        
    

    </body>
</html>

